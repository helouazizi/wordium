<div class="auth-container">
  <mat-card class="auth-card">
    <mat-card-header>
      <mat-card-title>Create Account</mat-card-title>
      <mat-card-subtitle>Join our community today</mat-card-subtitle>
    </mat-card-header>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <mat-card-content>
        <!-- Username Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Username</mat-label>
          <input matInput formControlName="username" placeholder="johndoe">
          <mat-icon matSuffix>person</mat-icon>
          @if (registerForm.controls.username.hasError('required')) {
            <mat-error>Username is required</mat-error>
          }
          @if (registerForm.controls.username.hasError('minlength')) {
            <mat-error>Minimum 3 characters required</mat-error>
          }
        </mat-form-field>

        <!-- Email Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" type="email" placeholder="name@example.com">
          <mat-icon matSuffix>email</mat-icon>
          @if (registerForm.controls.email.hasError('required')) {
            <mat-error>Email is required</mat-error>
          }
          @if (registerForm.controls.email.hasError('email')) {
            <mat-error>Please enter a valid email address</mat-error>
          }
        </mat-form-field>

        <!-- Password Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <input matInput [type]="hidePassword() ? 'password' : 'text'" formControlName="password">
          <button type="button" mat-icon-button matSuffix (click)="hidePassword.set(!hidePassword())">
            <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (registerForm.controls.password.hasError('required')) {
            <mat-error>Password is required</mat-error>
          }
          @if (registerForm.controls.password.hasError('minlength')) {
            <mat-error>Password must be at least 6 characters</mat-error>
          }
        </mat-form-field>

        <!-- Confirm Password Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword">
          <mat-icon matSuffix>lock_reset</mat-icon>
          
          <!-- Cross-field validation error -->
          @if (registerForm.hasError('passwordMismatch') && registerForm.controls.confirmPassword.touched) {
            <mat-error>Passwords do not match</mat-error>
          }
          @if (registerForm.controls.confirmPassword.hasError('required') && !registerForm.hasError('passwordMismatch')) {
            <mat-error>Please confirm your password</mat-error>
          }
        </mat-form-field>
      </mat-card-content>

      <mat-card-actions>
        <button 
          mat-flat-button 
          color="primary" 
          class="full-width submit-btn" 
          type="submit" 
          [disabled]="registerForm.invalid || isLoading()">
          
          @if (isLoading()) {
            <div class="spinner-container">
               <span>Creating account...</span>
            </div>
          } @else {
            <span>Register</span>
          }
        </button>
      </mat-card-actions>
    </form>

    <div class="auth-footer">
      Already have an account? <a routerLink="/login">Log In</a>
    </div>
  </mat-card>
</div>