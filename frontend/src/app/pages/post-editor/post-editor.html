<div class="editor-container" [class.preview-mode]="viewMode() === 'preview'">
  <div class="editor-header">
    <mat-form-field appearance="outline" class="title-input">
      <mat-label>Post Title</mat-label>
      <input
        matInput
        [(ngModel)]="title"
        placeholder="Write a catchy title..."
        autocomplete="off"
        #titleInput
      />
    </mat-form-field>
    <div class="toolbar">
      <button
        mat-icon-button
        color="primary"
        (click)="viewMode.set(viewMode() === 'edit' ? 'preview' : 'edit')"
        matTooltip="{{ viewMode() === 'edit' ? 'Preview' : 'Edit' }}"
      >
        <mat-icon>{{ viewMode() === 'edit' ? 'visibility' : 'edit' }}</mat-icon>
      </button>

      <mat-divider vertical></mat-divider>

      <button mat-icon-button (click)="insertFormat('bold')" matTooltip="Bold">
        <mat-icon>format_bold</mat-icon>
      </button>
      <button mat-icon-button (click)="insertFormat('italic')" matTooltip="Italic">
        <mat-icon>format_italic</mat-icon>
      </button>
      <button mat-icon-button (click)="insertFormat('link')" matTooltip="Link">
        <mat-icon>insert_link</mat-icon>
      </button>

      <mat-divider vertical></mat-divider>

      <button mat-icon-button (click)="insertFormat('list')" matTooltip="Bullet list">
        <mat-icon>format_list_bulleted</mat-icon>
      </button>
      <button mat-icon-button (click)="insertFormat('quote')" matTooltip="Quote">
        <mat-icon>format_quote</mat-icon>
      </button>
      <button mat-icon-button (click)="insertFormat('code')" matTooltip="Code block">
        <mat-icon>code</mat-icon>
      </button>

      <div class="upload-wrapper">
        <input
          type="file"
          #fileInput
          accept="image/*,video/mp4,video/webm"
          (change)="onMediaUpload($event)"
          hidden
        />
        <button
          mat-icon-button
          color="accent"
          (click)="fileInput.click()"
          [disabled]="isUploading()"
          matTooltip="Upload image or video"
        >
          <mat-icon *ngIf="!isUploading()">add_photo_alternate</mat-icon>
          <mat-spinner *ngIf="isUploading()" diameter="20"></mat-spinner>
        </button>
      </div>
    </div>
  </div>

  <div class="editor-body">
    <div class="edit-area" *ngIf="viewMode() === 'edit'">
      <textarea
        #editorTextarea
        [(ngModel)]="content"
        placeholder="Write your post here... (Markdown supported)"
        rows="20"
        spellcheck="true"
        class="markdown-textarea"
      ></textarea>
    </div>

    <div class="preview-area" *ngIf="viewMode() === 'preview'">
      <div class="preview-content markdown-body" [innerHTML]="content() | safeHtml | async"></div>
    </div>
  </div>

  <div class="editor-footer">
    <div class="footer-actions">
      <button mat-stroked-button (click)="cancel()" [disabled]="isSubmitting()">Cancel</button>

      <button
        mat-raised-button
        color="primary"
        [disabled]="isSubmitting() || !title().trim() || !content().trim()"
        (click)="submitPost()"
      >
        <mat-icon *ngIf="isSubmitting()">hourglass_empty</mat-icon>
        <span *ngIf="!isSubmitting()">Publish</span>
        <span *ngIf="isSubmitting()">Publishing...</span>
      </button>
    </div>
  </div>
</div>
