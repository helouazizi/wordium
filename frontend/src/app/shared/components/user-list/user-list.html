<div class="user-list">
  @if (err()) {
    <app-not-found [resource]="err()!" [linkText]="'Go Back'"></app-not-found>
  } @else {
    @if (initialLoading()) {
      <div class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading users...</p>
      </div>
    }
    @for (userItem of users(); track userItem.id) {
      <app-user-card
        [user]="userItem"
        [isOwner]="userItem.id === user?.id"
        [mode]="source()"
        (onBan)="banUser(userItem.id)"
        (onUnban)="unbanUser(userItem.id)"
        (onDelete)="deleteUser(userItem.id)"
        (onFollow)="togleFollow(userItem.id)"
        (onViewProfile)="viewProfile(userItem.id)"
      ></app-user-card>
    }
    @if (isEmpty()) {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <h3>No users yet</h3>
        <p>{{ emptyMessage() }}</p>
      </div>
    }
    @if (pageLoading()) {
      <div class="pagination-loader">
        <mat-progress-spinner diameter="28" mode="indeterminate" />
      </div>
    }
    @if (endReached()) {
      <div class="end-state">
        <mat-icon>person_outline</mat-icon>
        <span>You've reached the end! No more users to show.</span>
      </div>
    }

    <div #scrollAnchor class="scroll-anchor"></div>
  }
</div>
