<div class="post-list"  [class.feed]="source() === 'feed'" [class.grid-layout]="source() === 'profile' || source() === 'admin'" >
  @if (err()) {
    <app-not-found [resource]="err()!" [linkText]="'Go Back'"></app-not-found>
  } @else {
    @if (initialLoading()) {
      <div class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading postsâ€¦</p>
      </div>
    }
    @for (post of posts(); track post.id) {
      <app-post-card
        [user]="user!"
        [post]="post"
        (onReact)="reactToPost(post.id)"
        (onComment)="addComment(post.id, $event)"
        (onDelete)="deletePost(post.id)"
        (onReport)="reportPost(post.id, $event.type, $event.reason)"
        (onVisible)="handleVisibility(post.id)"
        [mode]="source()"
        [comments]="postComments()"
        [commentsLoading]="commentsLoading()"
        [commentsLastPage]="commentsLastPage()"
        (onLoadMoreComments)="loadMoreComments()"
        (onDeleteComment)="deleteComment(post.id,$event)"
      />
    }
    @if (isEmpty()) {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <h3>No posts yet</h3>
        <p>{{ emptyMessage() }}</p>
      </div>
    }
    @if (pageLoading()) {
      <div class="pagination-loader">
        <mat-progress-spinner diameter="28" mode="indeterminate" />
      </div>
    }
    @if (endReached() && source() !== 'detail') {
      <div class="end-state">
        <mat-icon>{{ endMessage.icon }}</mat-icon>
        <h3>{{ endMessage.title }}</h3>
        <p>{{ endMessage.message }}</p>

        @if (endMessage.action) {
          <button class="end-btn" mat-button color="primary" (click)="goToDiscover()">
            {{ endMessage.action }}
          </button>
        }
      </div>
    }

    <div #scrollAnchor class="scroll-anchor"></div>
  }
</div>
